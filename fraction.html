<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fractions Practice</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>🌓 Fractions Practice</h1>
<label for="level">Choose your Level:</label>
<select id="level" onchange="showFractionSection()">
    <option value="3">Fractions Addition & Subtraction (SameDenominator)</option>
    <option value="4">Whole Numbers and fractions Addition & Subtraction</option>
    <option value="5">Fraction Word Problems</option>
    <option value="6">Fractions Addition & Subtraction (Different Denominator)</option>
    <option value="7">Fractions Multiplication & Division</option>
    <option value="8">Percentage</option>
</select>

<label for="questionCount">Number of Questions:</label>
<select id="questionCount" onchange="setQuestionCount()">
    <option value="5">5 Questions</option>
    <option value="10">10 Questions</option>
    <option value="20">20 Questions</option>
    <option value="50">50 Questions</option>
    <option value="100">100 Questions</option>
</select>
<div id="quizActive">
    <!-- Level 3 Section -->
    <div class="section" id="level3">
        <h2>Fractions Addition & Subtraction (Same Denominator)</h2>
        <div id="y3-question">Click "Start" to begin the quiz</div>
        <input type="number" id="y3-numerator" placeholder="Num" disabled> /
        <input type="number" id="y3-denominator" placeholder="Den" disabled>
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="y3-result"></div>
    </div>

    <!-- Level 4 Section -->
    <div class="section" id="level4">
        <h2>Whole Numbers Addition & Subtraction</h2>
        <div id="y4-question">Click "Start" to begin the quiz</div>
        <input type="number" id="y4-numerator" placeholder="Num" disabled> /
        <input type="number" id="y4-denominator" placeholder="Den" disabled>
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="y4-result"></div>
    </div>

    <!-- Level 5 Section -->
    <div class="section" id="level5">
        <h2>fraction word problems</h2>
        <div id="wordProblemQuestion">Click "Start" to begin the quiz</div>
        <input type="number" id="wordProbNumerator" placeholder="Num" disabled> 
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="wordProblemResult"></div>
    </div>

    <!-- Level 6 Section -->
    <div class="section" id="level6">
        <h2>Fractions Addition & Subtraction (Different Denominator)</h2>
        <div id="y5-question">Click "Start" to begin the quiz</div>
        <input type="number" id="y5-numerator" placeholder="Num" disabled> /
        <input type="number" id="y5-denominator" placeholder="Den" disabled>
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="y5-result"></div>
    </div>

    <!-- Level 7 Section -->
    <div class="section" id="level7">
        <h2>Fractions Multiplication & Division</h2>
        <div id="y6-question">Click "Start" to begin the quiz</div>
        <input type="number" id="y6-numerator" placeholder="Num" disabled> /
        <input type="number" id="y6-denominator" placeholder="Den" disabled>
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="y6-result"></div>
    </div>

    <!-- Level 8 section -->
    <div class="section" id="level8">
        <h2>Percentage</h2>
        <div id="y7-question">Click "Start" to begin the quiz</div>
        <input type="number" id="y7-numerator" placeholder="Num" disabled>
        <button onclick="toggleAction()" id="actionBtn">Start</button>
        <div class="result" id="y7-result"></div>
    </div>
</div>
<div id="feedback"></div>
  <div class="score" id="score"></div>
  <div class="final" id="finalScore"></div>
  <div id="timer" style="font-size:18px; margin-top:10px;"></div>
  <div id="points" style="font-size:20px; margin-top:10px; color:#16a085;"></div>
  
  <br>
  <a href="index.html" class="back-btn">⬅ Back to Topics</a>
  <button class="back-btn" onclick="restartQuiz()">🔄 Restart Quiz</button>

<script src="scripts.js"></script>
<script>
    let questionCount = 0, correctCount = 0, totalQuestions = 5;
    let timerInterval, elapsedTime = 0;
    let level = 0;
    let isAnswerChecked = false; // Track if current answer has been checked
    let isQuizStarted = false; // Track if quiz has been started

function showFractionSection() {
    resetQuiz();
    level = document.getElementById('level').value;
    document.getElementById('level3').style.display = level === '3' ? 'block' : 'none';
    document.getElementById('level4').style.display = level === '4' ? 'block' : 'none';  
    document.getElementById('level5').style.display = level === '5' ? 'block' : 'none';
    document.getElementById('level6').style.display = level === '6' ? 'block' : 'none';
    document.getElementById('level7').style.display = level === '7' ? 'block' : 'none';
    document.getElementById('level8').style.display = level === '8' ? 'block' : 'none';
}

function setQuestionCount() {
    totalQuestions = parseInt(document.getElementById('questionCount').value);
    resetQuiz();
    resetToStartState();
}

function resetToStartState() {
    const level = document.getElementById('level').value;
    const actionBtn = document.getElementById('actionBtn');
    
    // Reset all input fields
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.value = '';
        input.disabled = true;
    });
    
    // Reset all question displays
    document.querySelectorAll('[id$="-question"]').forEach(question => {
        question.innerText = 'Click "Start" to begin the quiz';
    });
    
    // Reset all result displays
    document.querySelectorAll('.result').forEach(result => {
        result.innerText = '';
    });
    
    // Reset action button
    if (actionBtn) {
        actionBtn.innerText = 'Start';
        actionBtn.disabled = false;
    }
    
    isAnswerChecked = false;
    isQuizStarted = false;
    
    // Focus the button so Enter key works
    if (actionBtn) {
        actionBtn.focus();
    }
}

function restartQuiz() {
    // Reset all quiz variables
    questionCount = 0;
    correctCount = 0;
    isAnswerChecked = false;
    isQuizStarted = false;
    
    // Reset the quiz using the existing resetQuiz function from scripts.js
    resetQuiz();
    
    // Reset to start state
    resetToStartState();
    
    // Show quiz area if it was hidden
    document.getElementById('quizActive').style.display = 'block';
}

function startQuiz() {
    isQuizStarted = true;
    const level = document.getElementById('level').value;
    
    // Enable inputs for current level
    if (level === '3') {
        document.getElementById('y3-numerator').disabled = false;
        document.getElementById('y3-denominator').disabled = false;
        generateFractionAddSub();
    } else if (level === '4') {
        document.getElementById('y4-numerator').disabled = false;
        document.getElementById('y4-denominator').disabled = false;
        generateFractionAndWhole();
    } else if (level === '5') {
        document.getElementById('wordProbNumerator').disabled = false;
        generateFractionWorkProblems();
    } else if (level === '6') {
        document.getElementById('y5-numerator').disabled = false;
        document.getElementById('y5-denominator').disabled = false;
        generateFractionAddSubComplex();
    } else if (level === '7') {
        document.getElementById('y6-numerator').disabled = false;
        document.getElementById('y6-denominator').disabled = false;
        generateFractionMultiplyDivision();
    } else if (level === '8') {
        document.getElementById('y7-numerator').disabled = false;
        generatePercentage();
    }
}

function toggleAction() {
    if (!isQuizStarted) {
        startQuiz();
    } else if (isAnswerChecked) {
        // Move to next question
        const level = document.getElementById('level').value;
        if (level === '3') {
            generateFractionAddSub();
        } else if (level === '4') {
            generateFractionAndWhole();
        } else if (level === '5') {
            generateFractionWorkProblems();
        } else if (level === '6') {
            generateFractionAddSubComplex();
        } else if (level === '7') {
            generateFractionMultiplyDivision();
        } else if (level === '8') {
            generatePercentage();
        }
    } else {
        // Check current answer
        const level = document.getElementById('level').value;
        if (level === '3') {
            checkFractionAddSub();
        } else if (level === '4') {
            checkFractionAndWhole();
        } else if (level === '5') {
            checkFractionWorkProblems();
        } else if (level === '6') {
            checkFractionAddSubComplex();
        } else if (level === '7') {
            checkFractionMultiplyDivision();
        } else if (level === '8') {
            checkPercentage();
        }
    }
}

function handleEnterKey(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        const actionBtn = document.getElementById('actionBtn');
        if (actionBtn && !actionBtn.disabled) {
            toggleAction();
        }
    }
}

// Add global key listener when page loads
document.addEventListener('keydown', handleEnterKey);

// Focus the button when page loads so Enter key works immediately
document.addEventListener('DOMContentLoaded', function() {
    const actionBtn = document.getElementById('actionBtn');
    if (actionBtn) {
        actionBtn.focus();
    }
});

// Show only Level 3 by default
showFractionSection();

// Utility function to generate random number
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Fractions Addition & Subtraction (SameDenominator) Questions (Same Denominator)
let y3 = {};
function generateFractionAddSub() {
    // Only start timer on first question
    if (questionCount === 0) {
        startTimer();
    }
    
    handleQuizProgress();
    let denom = randInt(2, 10);
    let a = randInt(1, denom-1);
    let b = randInt(1, denom-1);
    y3 = {a, b, denom};
    let op = Math.random() < 0.5 ? '+' : '-';
    y3.op = op;
    document.getElementById('y3-question').innerText = `Q${questionCount + 1}: ${a}/${denom} ${op} ${b}/${denom}`;
    document.getElementById('y3-result').innerText = '';
    document.getElementById('feedback').innerText = "";
    
    // Reset button state
    document.getElementById('actionBtn').innerText = "Check";
    document.getElementById('actionBtn').disabled = false;
    isAnswerChecked = false;
    
    // Enable inputs
    document.getElementById('y3-numerator').disabled = false;
    document.getElementById('y3-denominator').disabled = false;
    
    // Focus on first input
    setTimeout(() => {
        document.getElementById('y3-numerator').focus();
    }, 10);
}
function checkFractionAddSub() {
    let num = parseInt(document.getElementById('y3-numerator').value);
    let den = parseInt(document.getElementById('y3-denominator').value);
    let correct = y3.op === '+' ? y3.a + y3.b : y3.a - y3.b;
    let feedback = document.getElementById('feedback');
    
    if (num  * y3.denom === correct * den) {
        feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
    } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correct}/${y3.denom}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
    
    // Update button state
    document.getElementById('actionBtn').innerText = "Next Question";
    isAnswerChecked = true;
    
    // Disable inputs
    document.getElementById('y3-numerator').disabled = true;
    document.getElementById('y3-denominator').disabled = true;
    
    // Check if quiz is complete
    if (questionCount >= totalQuestions) {
        document.getElementById('actionBtn').disabled = true;
        document.getElementById('finalScore').innerText = 
          `🎉 Quiz Finished! You got ${correctCount} out of ${totalQuestions} correct.`;
    }
}

// Addition/ subtraction with whole numbers
let y4 = {};
function generateFractionAndWhole() {
    handleQuizProgress();
    let a = randInt(1, 4);
    let b = randInt(1, 7);
    let c = randInt(b, 10);
    y4 = {a, b, c};
    let op = Math.random() < 0.5 ? '+' : '-';
    y4.op = op;
    document.getElementById('y4-question').innerText = `Question: ${a} ${op} ${b}/${c}`;
    document.getElementById('y4-result').innerText = '';
    document.getElementById('feedback').innerText = "";
}
function checkFractionAndWhole() {
    let num = parseInt(document.getElementById('y4-numerator').value);
    let den = parseInt(document.getElementById('y4-denominator').value);
    let correctNum = y4.op === '+' ? y4.a * y4.c + y4.b : y4.a * y4.c - y4.b;
    let correctDen = y4.c;
    let feedback = document.getElementById('feedback');

    // Accept equivalent fractions
    if (num * correctDen === correctNum * den) {
        feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
    } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correctNum}/${correctDen}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
}

// fraction word problems
let wordProblem = {};
function generateFractionWorkProblems() {
    handleQuizProgress();
    let a = randInt(1, 5);
    let b = randInt(1, 4);
    let c = b * randInt(1, 10);
    wordProblem = {a, b, c};
    document.getElementById('wordProblemQuestion').innerText = `Question: What is ${a}/${b} of ${c}?`;
    document.getElementById('wordProblemResult').innerText = '';
    document.getElementById('feedback').innerText = "";
}
function checkFractionWorkProblems() {
    let num = parseInt(document.getElementById('wordProbNumerator').value);
    let correctNum = wordProblem.a * (wordProblem.c / wordProblem.b);
    let feedback = document.getElementById('feedback');

    // Accept equivalent fractions
    if (num === correctNum) {
        feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
    } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correctNum}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
}

// Fractions Addition & Subtraction (Different Denominator) Questions (Different Denominator)
let y5 = {};
function generateFractionAddSubComplex() {
    handleQuizProgress();
    let denom1 = randInt(2, 10);
    let denom2 = randInt(2, 10);
    let a = randInt(1, denom1-1);
    let b = randInt(1, denom2-1);
    y5 = {a, b, denom1, denom2};
    let op = Math.random() < 0.5 ? '+' : '-';
    y5.op = op;
    document.getElementById('y5-question').innerText = `Question: ${a}/${denom1} ${op} ${b}/${denom2}`;
    document.getElementById('y5-result').innerText = '';
    document.getElementById('feedback').innerText = "";
}
function checkFractionAddSubComplex() {
    let num = parseInt(document.getElementById('y5-numerator').value);
    let den = parseInt(document.getElementById('y5-denominator').value);
    let lcm = y5.denom1 * y5.denom2 / gcd(y5.denom1, y5.denom2);
    let a = y5.a * (lcm / y5.denom1);
    let b = y5.b * (lcm / y5.denom2);
    let correctNum = y5.op === '+' ? a + b : a - b;
    let correctDen = lcm;
    let feedback = document.getElementById('feedback');

    // Accept equivalent fractions
    if (num * correctDen === correctNum * den) {
       feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
    } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correctNum}/${correctDen}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
}

// Fractions Multiplication & Division Questions (Multiplication & Division)
let y6 = {};
function generateFractionMultiplyDivision() {
    handleQuizProgress();
    let denom1 = randInt(2, 10);
    let denom2 = randInt(2, 10);
    let a = randInt(1, denom1-1);
    let b = randInt(1, denom2-1);
    let op = Math.random() < 0.5 ? '×' : '÷';
    y6 = {a, b, denom1, denom2, op};
    document.getElementById('y6-question').innerText = `Question: ${a}/${denom1} ${op} ${b}/${denom2}`;
    document.getElementById('y6-result').innerText = '';
    document.getElementById('feedback').innerText = "";
}
function checkFractionMultiplyDivision() {
    let num = parseInt(document.getElementById('y6-numerator').value);
    let den = parseInt(document.getElementById('y6-denominator').value);
    let correctNum, correctDen;
    if (y6.op === '×') {
        correctNum = y6.a * y6.b;
        correctDen = y6.denom1 * y6.denom2;
    } else {
        correctNum = y6.a * y6.denom2;
        correctDen = y6.denom1 * y6.b;
    }
    if (num * correctDen === correctNum * den) {
        feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
      } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correctNum}/${correctDen}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
}

function generatePercentage() {
    handleQuizProgress();
    let percent = randInt(1, 10) * 10;
    let random = randInt(1, 10);
    let base = random * percent;
    y7 = {percent, base};
    document.getElementById('y7-question').innerText = `Question: What is ${percent}% of ${base}?`;
    document.getElementById('y7-result').innerText = '';
    document.getElementById('feedback').innerText = "";
}

function checkPercentage() {
    let userAnswer = parseInt(document.getElementById('y7-numerator').value);
    let correctAnswer = Math.round(y7.percent / 100 * y7.base);
    if (userAnswer === correctAnswer) {
        feedback.innerText = "✅ Correct!";
        feedback.className = "correct";
        correctCount++;
      } else {
        feedback.innerText = `❌ Wrong. Correct answer is ${correctAnswer}`;
        feedback.className = "wrong";
    }
    questionCount++;
    document.getElementById('score').innerText = `Score: ${correctCount}/${questionCount}`;
}

// Greatest Common Divisor
function gcd(a,b) {
    while(b!==0){
        let t=b;
        b=a%b;
        a=t;
    }
    return a;
}

// Generate initial questions
generateFractionAddSub();
generateFractionAndWhole();
generateFractionAddSubComplex();
generateFractionMultiplyDivision();
generatePercentage();
</script>

</body>
</html>
